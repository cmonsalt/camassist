<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CamAssist - Configuraci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        @media (max-width: 768px) {
            .flex.h-screen {
                flex-direction: column;
            }

            aside {
                width: 100%;
                height: auto;
            }

            aside.w-64 {
                width: 100% !important;
            }

            aside .p-6 {
                padding: 1rem;
            }

            aside nav {
                display: flex;
                gap: 1rem;
            }

            aside .mt-auto {
                display: none;
            }

            main .p-8 {
                padding: 1rem;
            }

            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="icon" href="LogosMarca/icon16.png" type="image/png">
</head>

<body class="bg-gray-50">
    <div class="flex h-screen">
        <aside class="w-64 bg-gradient-to-b from-purple-600 to-pink-600 text-white flex flex-col">
            <div class="p-6">
                <div class="flex items-center mb-8">
                    <span class="text-3xl mr-3">ü§ñ</span>
                    <h1 class="text-xl font-bold">CamAssist</h1>
                </div>

                <nav class="space-y-2">
                    <a href="/dashboard/index.html"
                        class="flex items-center px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <span class="mr-3">üìä</span> Dashboard
                    </a>
                    <a href="/dashboard/modelos.html"
                        class="flex items-center px-4 py-3 rounded-lg bg-white/20 transition">
                        <span class="mr-3">üë•</span> Modelos
                    </a>
                    <a href="/dashboard/tiempo-config.html"
                        class="flex items-center px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <span class="mr-3">‚öôÔ∏è</span> Configurar Tiempo
                    </a>
                    <a href="/dashboard/extensiones.html"
                        class="flex items-center px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <span class="mr-3">üß©</span> Extensiones
                    </a>
                    <a href="/dashboard/facturacion.html"
                        class="flex items-center px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <span class="mr-3">üí≥</span> Facturaci√≥n
                    </a>
                </nav>
            </div>

            <div class="mt-auto p-6 border-t border-white/10">
                <div class="text-sm mb-4">
                    <div class="text-white/60">Studio</div>
                    <div class="font-semibold" id="studioName">Mi Studio</div>
                </div>
                <button onclick="logout()"
                    class="w-full flex items-center justify-center px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <span class="mr-2">üö™</span> Salir
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto">
            <div class="p-8 max-w-4xl">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Configuraci√≥n de Modelo</h1>
                    <p class="text-gray-600">Completa la informaci√≥n para que la IA responda mejor</p>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">üìã</span> Identidad
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nombre art√≠stico</label>
                            <input type="text" id="name" placeholder="Valentina"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Edad</label>
                            <input type="number" id="age" placeholder="24" min="18" max="99"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ciudad/Pa√≠s</label>
                            <input type="text" id="location" placeholder="Medell√≠n, Colombia"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Idiomas</label>
                            <select id="languages"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="spanish_only">Solo espa√±ol</option>
                                <option value="spanish_basic_english">Espa√±ol + ingl√©s b√°sico</option>
                                <option value="bilingual">Biling√ºe</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">üåê</span> Usernames por Plataforma
                    </h2>
                    <p class="text-xs text-gray-500 mb-4">‚ö†Ô∏è Los usernames NO se pueden cambiar una vez guardados.</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Chaturbate</label>
                            <input type="text" id="chaturbate_username" placeholder="username en Chaturbate"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">StripChat</label>
                            <input type="text" id="stripchat_username" placeholder="username en StripChat"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Streamate</label>
                            <input type="text" id="streamate_username" placeholder="username en Streamate"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">XModels</label>
                            <input type="text" id="xmodels_username" placeholder="username en XModels"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed">
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">üíÉ</span> Personalidad
                    </h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">¬øC√≥mo eres?</label>
                        <select id="personality"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="shy_flirty">T√≠mida pero coqueta</option>
                            <option value="extrovert_playful">Extrovertida y juguetona</option>
                            <option value="intellectual">Intelectual, me gusta conversar profundo</option>
                            <option value="funny">Divertida, bromista</option>
                            <option value="dominant">Dominante, me gusta llevar el control</option>
                            <option value="submissive">Sumisa, me gusta complacer</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Temas que te gusta conversar</label>
                        <input type="text" id="conversation_topics" placeholder="Ej: Reggaeton, viajar, gym, pel√≠culas"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Separa con comas</p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">üî•</span> F√≠sico y Nicho
                    </h2>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de cuerpo</label>
                            <select id="body_type"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="petite">Petite / Delgada</option>
                                <option value="curvy">Curvy / Con curvas</option>
                                <option value="bbw">BBW / Plus size</option>
                                <option value="athletic">Athletic / Fitness</option>
                                <option value="milf">MILF (30+)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nicho principal</label>
                            <input type="text" id="main_niche" placeholder="Ej: Latina caliente, Ebony, Asian"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tus mejores atributos</label>
                        <input type="text" id="best_features" placeholder="Ej: big ass, ojos, sonrisa, tatuajes"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Separa con comas</p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">‚úÖ</span> Lo que S√ç haces
                    </h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">En chat P√öBLICO</label>
                        <textarea id="public_shows" rows="2" placeholder="Ej: bailar, twerk, topless, lencer√≠a"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">En PRIVADO</label>
                        <textarea id="private_shows" rows="3" placeholder="Ej: desnudo completo, masturbaci√≥n, dildo"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">‚ùå</span> Lo que NO haces (nunca)
                    </h2>
                    <div>
                        <textarea id="hard_limits" rows="2" placeholder="Ej: anal, mostrar cara, humillaci√≥n"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                        <p class="text-xs text-gray-500 mt-1">La IA ofrecer√° alternativas cuando pidan esto</p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">‚ö†Ô∏è</span> Lo que haces con condiciones
                    </h2>
                    <div>
                        <textarea id="partial_conditions" rows="3" placeholder="Ej:
Anal: solo en privado de 30+ min
Squirt: solo con Lovense al m√°ximo"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Una condici√≥n por l√≠nea</p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">üé≠</span> Contexto personal
                    </h2>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">¬øTienes pareja?</label>
                            <select id="relationship_status"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="single">Soltera</option>
                                <option value="taken">Tengo novio/a</option>
                                <option value="no_say">Prefiero no decir</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Otra info relevante</label>
                        <textarea id="extra_context" rows="2" placeholder="Ej: Estudio medicina, me encanta el gym"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">üòä</span> Cantidad de Emojis
                    </h2>
                    <div class="grid grid-cols-4 gap-3">
                        <button onclick="setLevel('emoji', 0)" id="emoji-0"
                            class="py-2 px-4 rounded-lg border-2 border-gray-200 hover:border-purple-500 transition text-sm">
                            Sin
                        </button>
                        <button onclick="setLevel('emoji', 1)" id="emoji-1"
                            class="py-2 px-4 rounded-lg border-2 border-gray-200 hover:border-purple-500 transition text-sm">
                            Pocos (1)
                        </button>
                        <button onclick="setLevel('emoji', 2)" id="emoji-2"
                            class="py-2 px-4 rounded-lg border-2 border-purple-500 bg-purple-50 transition text-sm">
                            Normal (2)
                        </button>
                        <button onclick="setLevel('emoji', 3)" id="emoji-3"
                            class="py-2 px-4 rounded-lg border-2 border-gray-200 hover:border-purple-500 transition text-sm">
                            Muchos (3-4)
                        </button>
                    </div>
                </div>

                <button onclick="saveSettings()"
                    class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-4 rounded-xl hover:shadow-lg transform hover:scale-[1.01] transition-all duration-200 text-lg">
                    üíæ Guardar Configuraci√≥n
                </button>

                <p class="text-center text-sm text-gray-500 mt-4">
                    La informaci√≥n se guarda de forma segura
                </p>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const db = window.supabase.createClient(
            'https://wptjtwbvophyszijeupc.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwdGp0d2J2b3BoeXN6aWpldXBjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NTYyNzAsImV4cCI6MjA3OTMzMjI3MH0.CkpvCyuyr1P66xXedm936jc3B-6t4Crlhwbij_5A3QE'
        );

        const studioId = localStorage.getItem('studio_id');
        const studioName = localStorage.getItem('studio_name');
        if (!studioId) {
            window.location.href = '/dashboard/login.html';
        }
        document.getElementById('studioName').textContent = studioName || 'Mi Studio';

        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token') || localStorage.getItem('model_token');

        if (!token) {
            alert('No se encontr√≥ token de modelo');
            window.location.href = '/dashboard/modelos.html';
        }

        let emojiLevel = 2;

        loadSettings();

        async function loadSettings() {
            try {
                const { data, error } = await db
                    .from('models')
                    .select('*')
                    .eq('token', token)
                    .single();

                if (error) throw error;

                if (data) {
                    document.getElementById('name').value = data.name || '';
                    document.getElementById('age').value = data.age || '';
                    document.getElementById('location').value = data.location || '';
                    document.getElementById('languages').value = data.languages || 'spanish_only';
                    document.getElementById('personality').value = data.personality || 'extrovert_playful';
                    document.getElementById('conversation_topics').value = data.conversation_topics || '';
                    document.getElementById('body_type').value = data.body_type || 'curvy';
                    document.getElementById('main_niche').value = data.main_niche || '';
                    document.getElementById('best_features').value = data.best_features || '';
                    document.getElementById('public_shows').value = data.public_shows || '';
                    document.getElementById('private_shows').value = data.private_shows || '';
                    document.getElementById('hard_limits').value = data.hard_limits || '';
                    document.getElementById('partial_conditions').value = data.partial_conditions || '';
                    document.getElementById('relationship_status').value = data.relationship_status || 'single';
                    document.getElementById('extra_context').value = data.extra_context || '';
                    emojiLevel = data.emoji_level || 2;
                    setLevel('emoji', emojiLevel, false);

                    // Cargar usernames (bloqueados si tienen valor)
                    const usernameFields = ['chaturbate_username', 'stripchat_username', 'streamate_username', 'xmodels_username'];
                    usernameFields.forEach(field => {
                        const input = document.getElementById(field);
                        if (input) {
                            input.value = data[field] || '';
                            if (data[field]) {
                                input.disabled = true;
                                input.title = 'No se puede cambiar una vez guardado';
                            }
                        }
                    });
                    console.log('‚úÖ Settings cargados');
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function setLevel(type, level, updateState = true) {
            for (let i = 0; i <= 3; i++) {
                const btn = document.getElementById(`${type}-${i}`);
                if (btn) {
                    if (i === level) {
                        btn.classList.add('border-purple-500', 'bg-purple-50');
                        btn.classList.remove('border-gray-200');
                    } else {
                        btn.classList.remove('border-purple-500', 'bg-purple-50');
                        btn.classList.add('border-gray-200');
                    }
                }
            }
            if (updateState && type === 'emoji') {
                emojiLevel = level;
            }
        }

        async function saveSettings() {
            try {
                const { data, error } = await db
                    .from('models')
                    .update({
                        name: document.getElementById('name').value,
                        age: parseInt(document.getElementById('age').value) || null,
                        location: document.getElementById('location').value,
                        languages: document.getElementById('languages').value,
                        personality: document.getElementById('personality').value,
                        conversation_topics: document.getElementById('conversation_topics').value,
                        body_type: document.getElementById('body_type').value,
                        main_niche: document.getElementById('main_niche').value,
                        best_features: document.getElementById('best_features').value,
                        public_shows: document.getElementById('public_shows').value,
                        private_shows: document.getElementById('private_shows').value,
                        hard_limits: document.getElementById('hard_limits').value,
                        partial_conditions: document.getElementById('partial_conditions').value,
                        relationship_status: document.getElementById('relationship_status').value,
                        extra_context: document.getElementById('extra_context').value,
                        emoji_level: emojiLevel,
                        // Solo guardar usernames si el campo NO est√° deshabilitado
                        ...(document.getElementById('chaturbate_username').disabled ? {} : { chaturbate_username: document.getElementById('chaturbate_username').value || null }),
                        ...(document.getElementById('stripchat_username').disabled ? {} : { stripchat_username: document.getElementById('stripchat_username').value || null }),
                        ...(document.getElementById('streamate_username').disabled ? {} : { streamate_username: document.getElementById('streamate_username').value || null }),
                        ...(document.getElementById('xmodels_username').disabled ? {} : { xmodels_username: document.getElementById('xmodels_username').value || null })
                    })
                    .eq('token', token);

                if (error) throw error;

                alert('‚úÖ Configuraci√≥n guardada correctamente');
            } catch (error) {
                console.error('Error saving:', error);
                alert('‚ùå Error al guardar: ' + error.message);
            }
        }

        function logout() {
            localStorage.clear();
            window.location.href = '/dashboard/login.html';
        }
    </script>
</body>

</html>